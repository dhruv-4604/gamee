<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cheerful Biscuit Stacker</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Luckiest Guy', cursive;
        }

        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            font-size: x-large;
            font-family: 'Luckiest Guy', cursive;
            color: rgb(237, 237, 202);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        #backgroundImage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            object-fit: cover;
        }

        #landingPage,
        #endingPage {
            background-image: url('./assets/home-bg.jpg');
            background-size: cover;
            display: flex;
            justify-content: center;
            width: 100vw;
            height: 100vh;
        }

        #startButton,
        #restartButton,
        #playAgainButton,
        #homeButton {
            font-family: 'Luckiest Guy', cursive;
            font-size: xx-large;
            background-color: transparent;
            border: 5px solid rgb(162, 14, 61);
            border-radius: 10px;
            color: rgb(237, 237, 202);
        }

        /* From Uiverse.io by barisdogansutcu */
        button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 0 10px;
            color: rgb(237, 237, 202);
            text-shadow: 2px 2px rgb(116, 116, 116);
            text-transform: uppercase;
            border: 3px solid rgb(162, 14, 61);
            cursor: pointer;
            letter-spacing: 1px;
            font-weight: 600;
            font-size: 30px;
            font-family: 'Luckiest Guy', cursive;
            background-color: transparent;
            border-radius: 50px;
            position: relative;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        button:active {
            transform: scale(0.9);
            transition: all 100ms ease;
        }

        button img {
            transition: all 0.5s ease;
            z-index: 2;
        }

        .play {
            transition: all 0.5s ease;
            transition-delay: 300ms;
        }

        button:hover img {
            transform: scale(3) translate(120%);
        }

        .now {
            position: absolute;
            left: 0;
            transform: translateX(-100%);
            transition: all 0.5s ease;
            z-index: 2;
        }

        button:hover .now {
            transform: translateX(10px);
            transition-delay: 300ms;
        }

        button:hover .play {
            transform: translateX(200%);
            transition-delay: 300ms;
        }

        #endingPage {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        #finalScore {
            font-size: 48px;
            color: rgb(237, 237, 202);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }

        #endingButtons {
            display: flex;
            gap: 20px;
        }
    </style>
</head>

<body>
    <div id="landingPage">
        <div style="text-align: center;">
            <img src="./assets/logo.png" alt="Logo" style="height: 100px;margin-top: 10vh;">
            <p>
                Move your mouse or finger to control the plate at the bottom of the screen. <br><br>
                Catch falling biscuit pieces in the correct order: base, cream, and top. <br><br>
                Stack three pieces correctly to score a point. <br><br>
                If you catch a piece in the wrong order, your stack will fall off! <br><br>
                You have 120 seconds to score as many points as possible. <br><br>
            </p>
            <br>
            <div style="display: flex;align-items: center;justify-content: center;">
                <button id="startButton">
                    <img src="./assets/jim-jam.png" style="height: 25px;" alt="">
                    <span class="now">now!</span>
                    <span class="play">play</span>
                </button>
            </div>
        </div>
    </div>
    <div id="gameArea" style="display: none;">
        <img id="backgroundImage" src="assets/game-bg.jpg" alt="Background">
        <div id="info">Score: <span id="score">0</span> | Time: <span id="time">120</span></div>
    </div>
    <div id="endingPage">
        <div id="finalScore">Your Final Score: <span id="endScore"></span></div>
        <div id="endingButtons">
            <button id="restartButton">
                <img src="./assets/jim-jam.png" style="height: 25px;" alt="">
                <span class="now">again!</span>
                <span class="play">play</span>
            </button>

        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <script>
        const homeAudio = new Audio('./assets/Jim-Jam Stacking Game.mp3');
        homeAudio.play();
        homeAudio.loop = true;
        let scene, camera, renderer, plate, score = 0, timeLeft = 120;
        let fallingObjects = [];
        const plateStack = [];
        let gameAudio;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            document.body.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xFFFFA0, 0.8);
            directionalLight.position.set(5, 10, 7);
            scene.add(directionalLight);

            plate = createPlate();
            scene.add(plate);

            camera.position.z = 5;

            document.addEventListener('mousemove', onPointerMove);
            document.addEventListener('touchmove', onPointerMove);
            document.addEventListener('touchstart', onPointerMove);

            setInterval(createFallingObject, 1000);
            setInterval(updateTimer, 1000);

            window.addEventListener('resize', onWindowResize, false);
        }

        function createPlate() {
            const geometry = new THREE.CylinderGeometry(0.8, 0.8, 0.1, 32);
            const material = new THREE.MeshPhongMaterial({ color: 0xFFA500, shininess: 100 });
            const plate = new THREE.Mesh(geometry, material);
            plate.position.y = -2;
            return plate;
        }

        function createFallingObject() {
            const types = ['base', 'cream', 'top'];
            const type = types[Math.floor(Math.random() * types.length)];
            let object;

            switch (type) {
                case 'base':
                    object = createBase();
                    break;
                case 'cream':
                    object = createCream();
                    break;
                case 'top':
                    object = createTop();
                    break;
            }

            object.userData.type = type;
            object.position.set((Math.random() - 0.5) * 3, 3, 0);
            fallingObjects.push(object);
            scene.add(object);
        }

        function createBase() {
            const geometry = new THREE.CylinderGeometry(0.4, 0.4, 0.1, 32);
            const material = new THREE.MeshPhongMaterial({ color: 0xD2691E, shininess: 30 });
            return new THREE.Mesh(geometry, material);
        }

        function createCream() {
            const geometry = new THREE.CylinderGeometry(0.35, 0.35, 0.1, 32);
            const material = new THREE.MeshPhongMaterial({ color: 0xFFFACD, shininess: 50 });
            return new THREE.Mesh(geometry, material);
        }

        function createTop() {
            const group = new THREE.Group();

            const topGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.1, 32);
            const topMaterial = new THREE.MeshPhongMaterial({ color: 0xD2691E, shininess: 30 });
            const topMesh = new THREE.Mesh(topGeometry, topMaterial);
            group.add(topMesh);

            const jamGeometry = new THREE.SphereGeometry(0.1, 32, 32);
            const jamMaterial = new THREE.MeshPhongMaterial({ color: 0xFF0000, shininess: 80 });
            const jam = new THREE.Mesh(jamGeometry, jamMaterial);
            jam.position.y = 0.05;
            group.add(jam);

            return group;
        }

        function onPointerMove(event) {
            event.preventDefault();
            let clientX;

            if (event.type === 'touchmove' || event.type === 'touchstart') {
                clientX = event.touches[0].clientX;
            } else {
                clientX = event.clientX;
            }

            const x = (clientX / window.innerWidth) * 2 - 1;
            const newX = x * 3;
            const deltaX = newX - plate.position.x;
            plate.position.x = newX;

            plateStack.forEach(obj => {
                obj.position.x += deltaX;
            });
        }

        function updateTimer() {
            timeLeft--;
            document.getElementById('time').textContent = timeLeft;
            if (timeLeft <= 0) {
                endGame();
            }
        }

        function endGame() {
            gameAudio.pause();
            homeAudio.play();
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('endingPage').style.display = 'flex';
            document.getElementById('endScore').textContent = score;
        }

        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);

            fallingObjects.forEach((obj, index) => {
                obj.position.y -= 0.05;
                obj.rotation.y += 0.02;

                if (obj.position.y < -2 && Math.abs(obj.position.x - plate.position.x) < 0.5) {
                    scene.remove(obj);
                    fallingObjects.splice(index, 1);

                    if (checkStack(obj.userData.type)) {
                        plateStack.push(obj);
                        obj.position.y = -1.9 + (plateStack.length - 1) * 0.1;
                        obj.position.x = plate.position.x;
                        scene.add(obj);

                        new TWEEN.Tween(obj.position)
                            .to({ y: obj.position.y + 0.1 }, 100)
                            .easing(TWEEN.Easing.Bounce.Out)
                            .start();

                        if (plateStack.length === 3) {
                            score++;
                            document.getElementById('score').textContent = score;

                            plateStack.forEach((stackObj, i) => {
                                new TWEEN.Tween(stackObj.position)
                                    .to({ y: stackObj.position.y + 1 }, 500)
                                    .easing(TWEEN.Easing.Cubic.Out)
                                    .onComplete(() => {
                                        scene.remove(stackObj);
                                        if (i === plateStack.length - 1) {
                                            plateStack.length = 0;
                                        }
                                    })
                                    .start();

                                new TWEEN.Tween(stackObj.rotation)
                                    .to({ y: Math.PI * 2 }, 500)
                                    .start();
                            });
                        }
                    } else {
                        plateStack.forEach(stackObj => {
                            new TWEEN.Tween(stackObj.position)
                                .to({ y: -5 }, 1000)
                                .easing(TWEEN.Easing.Bounce.Out)
                                .onComplete(() => scene.remove(stackObj))
                                .start();

                            new TWEEN.Tween(stackObj.rotation)
                                .to({ x: Math.random() * Math.PI * 2, z: Math.random() * Math.PI * 2 }, 1000)
                                .start();
                        });
                        plateStack.length = 0;
                    }
                } else if (obj.position.y < -3) {
                    scene.remove(obj);
                    fallingObjects.splice(index, 1);
                }
            });

            renderer.render(scene, camera);
        }

        function checkStack(type) {
            if (plateStack.length === 0 && type === 'base') return true;
            if (plateStack.length === 1 && plateStack[0].userData.type === 'base' && type === 'cream') return true;
            if (plateStack.length === 2 && plateStack[0].userData.type === 'base' && plateStack[1].userData.type === 'cream' && type === 'top') return true;
            return false;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function startGame() {
            homeAudio.pause();
            gameAudio = new Audio('./assets/Ukulele Whistle.wav');
            gameAudio.loop = true;
            gameAudio.play();

            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            init();
            animate();
        }

        document.getElementById('startButton').addEventListener('click', startGame);
        document.getElementById('restartButton').addEventListener('click', startGame);
        document.getElementById('playAgainButton').addEventListener('click', function () {
            score = 0;
            timeLeft = 120;
            document.getElementById('score').textContent = '0';
            document.getElementById('time').textContent = '120';
            document.getElementById('endingPage').style.display = 'none';
            startGame();
        });
        document.getElementById('homeButton').addEventListener('click', function () {
            location.reload();
        });
    </script>
</body>

</html>